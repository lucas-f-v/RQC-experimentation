name: Python File Commit Trigger

on:
  push:
    paths:
      - '**/*.py'

jobs:
  run-on-python-file-commit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'  # Specify the Python version you need

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          - name: Get Bearer Token
          id: get_token
          run: |
            response=$(curl --location --request POST 'https://idm.stackspot.com/stackspot/oidc/oauth/token' \
              --header 'Content-Type: application/x-www-form-urlencoded' \
              --data-urlencode 'client_id=f4096bfc-7f7c-4401-806f-411b19bd0959' \
              --data-urlencode 'grant_type=client_credentials' \
              --data-urlencode 'client_secret=1I61F1M93LMS7mElqDacgyD7NSYtv4s6xC854f7IhMvF6OrJ5Cic5wzvwW2I3IX8')
            echo "response=$response"
            token=$(echo $response | jq -r '.access_token')
            echo "::set-output name=token::$token"
            
      - name: RQC1-post
        run: |
          echo "A Python file was committed!"
          # Add your custom commands or scripts here
